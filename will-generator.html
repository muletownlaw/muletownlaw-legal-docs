<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Will Generator - Muletown Law</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen py-8">
    <div class="max-w-4xl mx-auto px-4">
        <div class="bg-white rounded-lg shadow-xl p-8 mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">Tennessee Will Generator</h1>
            <p class="text-gray-600 mb-6">Muletown Law - Estate Planning Documents</p>
            
            <form id="willForm" class="space-y-6">
                <!-- Client Information -->
                <div class="border-b pb-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">Client Information</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Client Name *
                            </label>
                            <input type="text" name="CLIENT_NAME" required
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Client Gender *
                            </label>
                            <select name="CLIENT_GENDER" required
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                County *
                            </label>
                            <input type="text" name="CLIENT_COUNTY" value="Maury" required
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Spouse Name (if married)
                            </label>
                            <input type="text" name="CLIENT_SPOUSE_NAME"
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                    </div>
                </div>
                
                <!-- Executor Information -->
                <div class="border-b pb-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">Executor Information</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Alternate Executor Name *
                            </label>
                            <input type="text" name="ALTERNATE_EXECUTOR_NAME" required
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Relationship to Client *
                            </label>
                            <input type="text" name="ALTERNATE_EXECUTOR_RELATION" required
                                placeholder="brother, sister, friend, etc."
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                    </div>
                </div>
                
                <!-- Children -->
                <div class="border-b pb-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">Children</h2>
                    <div id="childrenContainer" class="space-y-4"></div>
                    <button type="button" onclick="addChild()" 
                        class="mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                        Add Child
                    </button>
                </div>
                
                <!-- Optional Clauses -->
                <div class="border-b pb-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">Optional Provisions</h2>
                    
                    <div class="space-y-3">
                        <label class="flex items-center">
                            <input type="checkbox" name="INCLUDE_HANDWRITTEN_LIST" 
                                class="w-4 h-4 text-blue-600 rounded focus:ring-blue-500">
                            <span class="ml-2 text-gray-700">Include Handwritten List Provision</span>
                        </label>
                        
                        <label class="flex items-center">
                            <input type="checkbox" name="INCLUDE_NO_CONTEST" 
                                class="w-4 h-4 text-blue-600 rounded focus:ring-blue-500">
                            <span class="ml-2 text-gray-700">Include No Contest Clause</span>
                        </label>
                        
                        <label class="flex items-center">
                            <input type="checkbox" name="INCLUDE_REAL_ESTATE_DEBT" 
                                class="w-4 h-4 text-blue-600 rounded focus:ring-blue-500">
                            <span class="ml-2 text-gray-700">Include Real Estate Indebtedness Clause</span>
                        </label>
                        
                        <label class="flex items-center">
                            <input type="checkbox" name="INCLUDE_SELL_REAL_ESTATE" 
                                class="w-4 h-4 text-blue-600 rounded focus:ring-blue-500">
                            <span class="ml-2 text-gray-700">Include Authority to Sell Real Estate</span>
                        </label>
                        
                        <label class="flex items-center">
                            <input type="checkbox" name="INCLUDE_DISINHERITANCE" id="includeDisinheritance"
                                onchange="toggleDisinheritance()"
                                class="w-4 h-4 text-blue-600 rounded focus:ring-blue-500">
                            <span class="ml-2 text-gray-700">Include Disinheritance Clause</span>
                        </label>
                        
                        <div id="disinheritanceFields" class="hidden ml-6 mt-2 space-y-2">
                            <input type="text" name="DISINHERITED_NAME" placeholder="Name of person"
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                            <input type="text" name="DISINHERITED_RELATION" placeholder="Relationship (son, daughter, etc.)"
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                        </div>
                    </div>
                </div>
                
                <!-- Execution Date -->
                <div class="border-b pb-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">Execution Date</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Month *</label>
                            <select name="EXEC_MONTH" required
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="January">January</option>
                                <option value="February">February</option>
                                <option value="March">March</option>
                                <option value="April">April</option>
                                <option value="May">May</option>
                                <option value="June">June</option>
                                <option value="July">July</option>
                                <option value="August">August</option>
                                <option value="September">September</option>
                                <option value="October" selected>October</option>
                                <option value="November">November</option>
                                <option value="December">December</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Year *</label>
                            <input type="text" name="EXEC_YEAR" value="2025" required
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                    </div>
                </div>
                
                <!-- Submit Button -->
                <div class="flex justify-center pt-6">
                    <button type="submit"
                        class="px-8 py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 focus:ring-4 focus:ring-green-300 transition">
                        Generate Will
                    </button>
                </div>
            </form>
            
            <div id="status" class="mt-6 text-center"></div>
        </div>
    </div>
    
    <script>
        let childCount = 0;
        
        function addChild() {
            childCount++;
            const container = document.getElementById('childrenContainer');
            const childDiv = document.createElement('div');
            childDiv.className = 'border border-gray-200 rounded-lg p-4';
            childDiv.innerHTML = `
                <div class="flex justify-between items-center mb-2">
                    <h3 class="font-medium text-gray-700">Child ${childCount}</h3>
                    <button type="button" onclick="removeChild(this)" 
                        class="text-red-600 hover:text-red-800">Remove</button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                    <input type="text" name="child_name_${childCount}" placeholder="Full Name" required
                        class="px-3 py-2 border border-gray-300 rounded-lg">
                    <input type="date" name="child_dob_${childCount}" required
                        class="px-3 py-2 border border-gray-300 rounded-lg">
                    <select name="child_gender_${childCount}"
                        class="px-3 py-2 border border-gray-300 rounded-lg">
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                    </select>
                </div>
            `;
            container.appendChild(childDiv);
        }
        
        function removeChild(button) {
            button.closest('.border').remove();
        }
        
        function toggleDisinheritance() {
            const checkbox = document.getElementById('includeDisinheritance');
            const fields = document.getElementById('disinheritanceFields');
            fields.classList.toggle('hidden', !checkbox.checked);
        }
        
        document.getElementById('willForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const status = document.getElementById('status');
            status.innerHTML = '<p class="text-blue-600">Generating will...</p>';
            
            const formData = new FormData(e.target);
            const data = {};
            
            // Collect form data
            for (let [key, value] of formData.entries()) {
                if (key.startsWith('child_')) {
                    // Handle children separately
                    continue;
                }
                if (e.target.elements[key]?.type === 'checkbox') {
                    data[key] = e.target.elements[key].checked;
                } else {
                    data[key] = value;
                }
            }
            
            // Collect children
            data.children = [];
            for (let i = 1; i <= childCount; i++) {
                const name = formData.get(`child_name_${i}`);
                const dob = formData.get(`child_dob_${i}`);
                const gender = formData.get(`child_gender_${i}`);
                if (name) {
                    // Format date
                    const dateObj = new Date(dob);
                    const months = ['January', 'February', 'March', 'April', 'May', 'June', 
                                  'July', 'August', 'September', 'October', 'November', 'December'];
                    const formatted = `${months[dateObj.getMonth()]} ${dateObj.getDate()}, ${dateObj.getFullYear()}`;
                    
                    data.children.push({
                        name: name,
                        dob: formatted,
                        gender: gender
                    });
                }
            }
            
            try {
                const response = await fetch('/api/generate-will', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `Will_${data.CLIENT_NAME.replace(/ /g, '_')}.docx`;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                    
                    status.innerHTML = '<p class="text-green-600 font-semibold">âœ“ Will generated successfully!</p>';
                } else {
                    const error = await response.json();
                    status.innerHTML = `<p class="text-red-600">Error: ${error.error}</p>`;
                }
            } catch (error) {
                status.innerHTML = `<p class="text-red-600">Error: ${error.message}</p>`;
            }
        });
    </script>
</body>
</html>
