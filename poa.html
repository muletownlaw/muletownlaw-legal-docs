<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tennessee Power of Attorney Generator</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script>
        const { useState } = React;

        function POAGenerator() {
            const [formData, setFormData] = useState({
                CLIENT_NAME: '',
                CLIENT_GENDER: 'Female',
                COUNTY: 'Maury',
                AIF_RELATIONSHIP: '',
                AIF_NAME: '',
                ALTERNATE_AIF_RELATIONSHIP: '',
                ALTERNATE_AIF_NAME: '',
                EXEC_MONTH: 'October',
                EXEC_YEAR: '2025'
            });

            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');
            const [success, setSuccess] = useState(false);

            const handleInputChange = (e) => {
                setFormData({
                    ...formData,
                    [e.target.name]: e.target.value
                });
            };

            const handleGenerate = async () => {
                // Validation
                if (!formData.CLIENT_NAME.trim()) {
                    setError('Client name is required');
                    return;
                }
                if (!formData.AIF_NAME.trim()) {
                    setError('Attorney-in-Fact name is required');
                    return;
                }
                if (!formData.ALTERNATE_AIF_NAME.trim()) {
                    setError('Alternate Attorney-in-Fact name is required');
                    return;
                }

                setLoading(true);
                setError('');
                setSuccess(false);

                try {
                    console.log('Sending request to /api/generate-poa...');
                    
                    const response = await fetch('/api/generate-poa', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(formData)
                    });

                    console.log('Response status:', response.status);

                    if (!response.ok) {
                        const errorData = await response.json();
                        console.error('Error details:', errorData);
                        throw new Error(errorData.error || errorData.traceback || 'Failed to generate document');
                    }

                    // Get the blob
                    const blob = await response.blob();
                    console.log('Received blob, size:', blob.size);

                    // Create download link
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `POA_${formData.CLIENT_NAME.replace(/\s+/g, '_')}_${Date.now()}.docx`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);

                    setSuccess(true);
                    console.log('Download complete');

                } catch (err) {
                    console.error('Generation error:', err);
                    setError(err.message || 'Failed to generate document. Check console for details.');
                } finally {
                    setLoading(false);
                }
            };

            return (
                React.createElement('div', { className: 'min-h-screen bg-gray-100 py-8 px-4' },
                    React.createElement('div', { className: 'max-w-4xl mx-auto' },
                        React.createElement('div', { className: 'bg-white rounded-lg shadow-lg p-8' },
                            React.createElement('h1', { className: 'text-3xl font-bold text-gray-900 mb-2' }, 'Tennessee Power of Attorney Generator'),
                            React.createElement('p', { className: 'text-gray-600 mb-8' }, 'Muletown Law, P.C.'),
                            
                            React.createElement('div', { className: 'space-y-8' },
                                
                                React.createElement('div', null,
                                    React.createElement('h2', { className: 'text-xl font-bold text-gray-900 mb-4' }, 'Client Information'),
                                    React.createElement('div', { className: 'space-y-4' },
                                        React.createElement('div', null,
                                            React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-2' }, 'Client Name *'),
                                            React.createElement('input', {
                                                type: 'text',
                                                name: 'CLIENT_NAME',
                                                value: formData.CLIENT_NAME,
                                                onChange: handleInputChange,
                                                className: 'w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500',
                                                placeholder: 'Enter client full name'
                                            })
                                        ),
                                        React.createElement('div', null,
                                            React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-2' }, 'Client Gender'),
                                            React.createElement('select', {
                                                name: 'CLIENT_GENDER',
                                                value: formData.CLIENT_GENDER,
                                                onChange: handleInputChange,
                                                className: 'w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500'
                                            },
                                                React.createElement('option', { value: 'Female' }, 'Female'),
                                                React.createElement('option', { value: 'Male' }, 'Male')
                                            )
                                        ),
                                        React.createElement('div', null,
                                            React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-2' }, 'County'),
                                            React.createElement('input', {
                                                type: 'text',
                                                name: 'COUNTY',
                                                value: formData.COUNTY,
                                                onChange: handleInputChange,
                                                className: 'w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500',
                                                placeholder: 'Enter county'
                                            })
                                        )
                                    )
                                ),
                                
                                React.createElement('div', null,
                                    React.createElement('h2', { className: 'text-xl font-bold text-gray-900 mb-4' }, 'Attorney-in-Fact Information'),
                                    React.createElement('div', { className: 'space-y-4' },
                                        React.createElement('div', null,
                                            React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-2' }, 'Attorney-in-Fact Name *'),
                                            React.createElement('input', {
                                                type: 'text',
                                                name: 'AIF_NAME',
                                                value: formData.AIF_NAME,
                                                onChange: handleInputChange,
                                                className: 'w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500',
                                                placeholder: "Usually the client's spouse"
                                            })
                                        ),
                                        React.createElement('div', null,
                                            React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-2' }, 'Attorney-in-Fact Relationship'),
                                            React.createElement('input', {
                                                type: 'text',
                                                name: 'AIF_RELATIONSHIP',
                                                value: formData.AIF_RELATIONSHIP,
                                                onChange: handleInputChange,
                                                className: 'w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500',
                                                placeholder: 'e.g., wife, husband, daughter, son'
                                            })
                                        ),
                                        React.createElement('div', null,
                                            React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-2' }, 'Alternate Attorney-in-Fact Name *'),
                                            React.createElement('input', {
                                                type: 'text',
                                                name: 'ALTERNATE_AIF_NAME',
                                                value: formData.ALTERNATE_AIF_NAME,
                                                onChange: handleInputChange,
                                                className: 'w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500',
                                                placeholder: 'Enter alternate attorney-in-fact name'
                                            })
                                        ),
                                        React.createElement('div', null,
                                            React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-2' }, 'Alternate Attorney-in-Fact Relationship'),
                                            React.createElement('input', {
                                                type: 'text',
                                                name: 'ALTERNATE_AIF_RELATIONSHIP',
                                                value: formData.ALTERNATE_AIF_RELATIONSHIP,
                                                onChange: handleInputChange,
                                                className: 'w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500',
                                                placeholder: 'e.g., son, daughter, sibling'
                                            })
                                        )
                                    )
                                ),
                                
                                React.createElement('div', null,
                                    React.createElement('h2', { className: 'text-xl font-bold text-gray-900 mb-4' }, 'Execution Details'),
                                    React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-4' },
                                        React.createElement('div', null,
                                            React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-2' }, 'Execution Month'),
                                            React.createElement('input', {
                                                type: 'text',
                                                name: 'EXEC_MONTH',
                                                value: formData.EXEC_MONTH,
                                                onChange: handleInputChange,
                                                className: 'w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500',
                                                placeholder: 'e.g., October'
                                            })
                                        ),
                                        React.createElement('div', null,
                                            React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-2' }, 'Execution Year'),
                                            React.createElement('input', {
                                                type: 'text',
                                                name: 'EXEC_YEAR',
                                                value: formData.EXEC_YEAR,
                                                onChange: handleInputChange,
                                                className: 'w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500',
                                                placeholder: 'e.g., 2025'
                                            })
                                        )
                                    )
                                ),
                                
                                error &&
                                    React.createElement('div', { className: 'p-4 bg-red-50 border border-red-200 rounded-md' },
                                        React.createElement('p', { className: 'text-sm text-red-700' }, '❌ ' + error)
                                    ),
                                
                                success &&
                                    React.createElement('div', { className: 'p-4 bg-green-50 border border-green-200 rounded-md' },
                                        React.createElement('h3', { className: 'text-lg font-medium text-green-900 mb-2' }, '✓ Document Generated Successfully!'),
                                        React.createElement('p', { className: 'text-sm text-green-700' }, 'Your Power of Attorney document has been downloaded.')
                                    ),
                                
                                React.createElement('div', { className: 'pt-4' },
                                    React.createElement('button', {
                                        onClick: handleGenerate,
                                        disabled: loading,
                                        className: 'w-full bg-blue-600 text-white px-6 py-3 rounded-md hover:bg-blue-700 font-medium disabled:bg-gray-400 disabled:cursor-not-allowed'
                                    }, loading ? 'Generating...' : 'Generate & Download Document')
                                )
                            )
                        )
                    )
                )
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(POAGenerator));
    </script>
</body>
</html>
